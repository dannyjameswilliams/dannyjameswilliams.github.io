<!DOCTYPE html><html lang="en-gb" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Daniel Williams">

  
  
  
    
  
  <meta name="description" content="This is a blog post detailing Approximate Stein Classes for Truncated Density Estimation, by myself and my supervisor, Song Liu, which recently got accepted into ICML 2023.">

  
  <link rel="alternate" hreflang="en-gb" href="https://dannyjameswilliams.co.uk/post/tksd/">

  


  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu6de9a8f7dd4e8a8bd7c2613cf2ad59bf_37670_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu6de9a8f7dd4e8a8bd7c2613cf2ad59bf_37670_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="https://dannyjameswilliams.co.uk/post/tksd/">

  
  
  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@DanielW966">
  <meta property="twitter:creator" content="@DanielW966">
  
  <meta property="og:site_name" content="Danny James Williams">
  <meta property="og:url" content="https://dannyjameswilliams.co.uk/post/tksd/">
  <meta property="og:title" content="2 Years of PhD Research: Stein Discrepancies with a Twist | Danny James Williams">
  <meta property="og:description" content="This is a blog post detailing Approximate Stein Classes for Truncated Density Estimation, by myself and my supervisor, Song Liu, which recently got accepted into ICML 2023."><meta property="og:image" content="https://dannyjameswilliams.co.uk/post/tksd/featured.png">
  <meta property="twitter:image" content="https://dannyjameswilliams.co.uk/post/tksd/featured.png"><meta property="og:locale" content="en-gb">
  
    
      <meta property="article:published_time" content="2023-06-05T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2023-06-05T11:02:39&#43;01:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://dannyjameswilliams.co.uk/post/tksd/"
  },
  "headline": "2 Years of PhD Research: Stein Discrepancies with a Twist",
  
  "image": [
    "https://dannyjameswilliams.co.uk/post/tksd/featured.png"
  ],
  
  "datePublished": "2023-06-05T00:00:00Z",
  "dateModified": "2023-06-05T11:02:39+01:00",
  
  "author": {
    "@type": "Person",
    "name": "Daniel Williams"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "University of Bristol",
    "logo": {
      "@type": "ImageObject",
      "url": "https://dannyjameswilliams.co.uk/images/icon_hu6de9a8f7dd4e8a8bd7c2613cf2ad59bf_37670_192x192_fill_lanczos_center_2.png"
    }
  },
  "description": "This is a blog post detailing Approximate Stein Classes for Truncated Density Estimation, by myself and my supervisor, Song Liu, which recently got accepted into ICML 2023."
}
</script>

  

  


  


  





  <title>2 Years of PhD Research: Stein Discrepancies with a Twist | Danny James Williams</title>

</head>
<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  









<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Danny James Williams</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Danny James Williams</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#home"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/publications/"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/post/"><span>Blog</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/projects/"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/tutorials/"><span>Tutorials</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/portfolios/"><span>Portfolios</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>About</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/files/cv.pdf"><span>CV</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link js-theme-selector" data-toggle="dropdown" aria-haspopup="true">
          <i class="fas fa-palette" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  




















  
  


<div class="article-container pt-3">
  <h1>2 Years of PhD Research: Stein Discrepancies with a Twist</h1>

  
  <p class="page-subtitle">Do you want to estimate a truncated density? Do you have access to a functional form of the boundary? I didn&rsquo;t think so.</p>
  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    Jun 5, 2023
  </span>
  

  

  

  
  
  

  
  

</div>

  














</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 594px; max-height: 361px;">
  <div style="position: relative">
    <img src="/post/tksd/featured.png" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      


<p>This is a blog post detailing <a href="https://arxiv.org/abs/2306.00602">Approximate Stein Classes for Truncated Density Estimation</a>, by myself and my supervisor, Song Liu, which recently got accepted into <strong>ICML 2023</strong>.</p>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Pretend, for a moment, that you are the kind of person who likes to see where animals live, and you go out for the day to find where all the animal habitats are. You are interested in the broader picture; the general spread of habitat locations across a certain region. What you would be doing is looking to <strong>model a density</strong> based on each observation of a habitat. However, you might find that these habitats arbitrarily stop after some point, and you don’t have an exact reason why. In a similar way, you might not be allowed to cross into a neighbouring country to continue measurements. In both of these scenarios, you are prohibited from viewing a <em>full picture</em> of your dataset due to some unknown circumstances - but you <em>do</em> have access to something, which is a collection of points that roughly make up the ‘edge’ of your domain, where <strong>your data are truncated</strong>. <em>How do you estimate your density now?</em></p>
<div id="background" class="section level2">
<h2>Background</h2>
<p>Up until the introduction of this work, to estimate the density of your wildlife habitat locations, you would probably try to use <em>TruncSM</em> <a href="#truncsm">[1]</a>, a very fine work which uses Score Matching <a href="#scorematching1">[2]</a> to do truncated density estimation. This work is quite interesting if you are a fan of this kind of thing. If you want to read more about it I also wrote a <a href="https://dannyjameswilliams.co.uk/post/nodata/">blog post last year</a> which goes into a few more details, or read <a href="https://www.jmlr.org/papers/volume23/21-0218/21-0218.pdf">the full paper here</a>.</p>
<p>The jist of the method is that our true density, <span class="math inline">\(q\)</span>, (which is made up of only samples, only the wildlife habitats we observed) needs to be modelled by something which we denote as <span class="math inline">\(p_{\boldsymbol{\theta}}\)</span>, which looks like
<span class="math display">\[
p_{\boldsymbol{\theta}}= \frac{\bar{p}_{\boldsymbol{\theta}}}{Z(\boldsymbol{\theta})}, \; \; \; Z(\boldsymbol{\theta}) = \int_{V}\bar{p}_{\boldsymbol{\theta}} d\boldsymbol{x}.
\]</span>
We can modify <span class="math inline">\(p_{\boldsymbol{\theta}}\)</span> only through <span class="math inline">\(\boldsymbol{\theta}\)</span>, and so we want to find a <span class="math inline">\(\boldsymbol{\theta}\)</span> such that
<span class="math display">\[
p_{\boldsymbol{\theta}}\approx q.
\]</span>
This is relatively straightforward most of the time, when we integrate <span class="math inline">\(Z(\boldsymbol{\theta})\)</span> in a ‘normal’ way (<span class="math inline">\(V = \mathbb{R}^d\)</span>). But this blog post is not about ‘most of the time’, we are looking at something harder (<span class="math inline">\(V \neq \mathbb{R}^d\)</span>). The integration for <span class="math inline">\(Z(\boldsymbol{\theta})\)</span> is really hard. So hard in fact, that no one wants to integrate it at all (sorry <span class="math inline">\(Z(\boldsymbol{\theta})\)</span> but you’re too difficult). This is known as <em>unnormalised density estimation</em>. Well, turns out we can ignore our issues altogether if we just use Score matching. <strong>By using Score Matching we can ignore the difficult parts of what makes estimating a truncated density hard</strong>.</p>
<p>Our method, Truncated Kernelised Stein Discrepancies (what a mouthful, we’ll call it TKSD from now on), uses the same broad strokes as Score Matching, which, roughly speaking, means we also use the <em>score function</em>,
<span class="math display">\[
\boldsymbol{\psi}_{p_{\boldsymbol{\theta}}} = \nabla_\boldsymbol{x} \log p(\boldsymbol{x}; \boldsymbol{\theta}),
\]</span>
a Stein operator,
<span class="math display">\[
\mathcal{T}_{p_{\boldsymbol{\theta}}} \boldsymbol{f}(\boldsymbol{x}) := \sum^d_{l=1}\psi_{p_{\boldsymbol{\theta}}, l}(\boldsymbol{x}) f_l(\boldsymbol{x}) + \partial_{x_l}f_l(\boldsymbol{x}),
\]</span>
and the knowledge that
<span class="math display" id="eq:stein">\[\begin{equation}
\mathbb{E}_{q} [\mathcal{T}_{q} \boldsymbol{f}(\boldsymbol{x})] = 0 \tag{1}
\end{equation}\]</span>
if, for <span class="math inline">\(\boldsymbol{f} \in \mathcal{F}^d\)</span>, <span class="math inline">\(\mathcal{F}^d\)</span> is a <em>Stein class</em> of functions (note that both the expectation and Stein operator are with respect to the density <span class="math inline">\(q\)</span>). These three equations form the basis for a lot of unnormalised density estimation, thus it makes sense that we want to use them when developing a new method.</p>
<p>Instead of minimising the score matching divergence like <em>TruncSM</em>, we want to construct a discrepancy based on Minimum Stein discrepancies <a href="#barp2019">[3]</a>. If we want to make the two densities, <span class="math inline">\(p_{\boldsymbol{\theta}}\)</span> and <span class="math inline">\(q\)</span>, as close to each other as possible, we would want to minimise <a href="#eq:stein">(1)</a>, since if it equals zero, then the two densities are equal. We also go one step further than that, by making this problem <em>as challenging as possible</em> by including a maximisation (supremum) over the function class also:
<span class="math display" id="eq:minsup">\[\begin{equation}
\min_{\boldsymbol{\theta}} \sup_{\boldsymbol{f} \in \mathcal{F}^d}\mathbb{E}_{q} [\mathcal{T}_{p_{\boldsymbol{\theta}}} \boldsymbol{f}(\boldsymbol{x})]. \tag{2}
\end{equation}\]</span>
If we let <span class="math inline">\(\mathcal{F}^d\)</span> be an reproducing kernel Hilbert space (RKHS), then <a href="#eq:minsup">(2)</a> can be evaluated exactly. This is called Kernelised Stein Discrepancy (KSD) <a href="#ksd">[4]</a>.</p>
</div>
</div>
<div id="tksd-how-does-he-do-it" class="section level1">
<h1>TKSD: How <em>does</em> he do it?</h1>
<p>Well, we described above what we <em>want</em> to use, but we can’t <em>actually</em> use it. All because of that pesky truncation. The issue is due to <a href="#eq:stein">(1)</a> <em>not actually holding</em> when the density is truncated in a way which we do not know (recall the aim of this project is to be able to estimate the density when we do not have an exact form of the truncation boundary, and instead access it through a set of points). The actual cause is complicated, but involves the derivation of <a href="#eq:stein">(1)</a>, and a boundary condition on an integration by parts not holding when the density is truncated. So, we have to do something slightly different.</p>
<p>Two lemmas, one proposition, one remark and one final theorem later, we get the following:
<span class="math display" id="eq:approxstein">\[\begin{equation}
\mathbb{E}_{q} [ \mathcal{T}_{q} \tilde{\boldsymbol{g}}(\boldsymbol{x}) ] = O_P(\varepsilon_m), \tag{3}
\end{equation}\]</span>
for <span class="math inline">\(\tilde{\boldsymbol{g}} \in \mathcal{G}^d_{0, m}\)</span>, where <span class="math inline">\(\mathcal{G}^d_{0, m}\)</span> is basically a set of functions which we optimise over (similar to <span class="math inline">\(\mathcal{F}^d\)</span> above), but also include a constraint on a <em>finite set of boundary points</em> of size <span class="math inline">\(m\)</span>, such that <span class="math inline">\(\tilde{\boldsymbol{g}}(\boldsymbol{x}&#39;) = 0\)</span> for all <span class="math inline">\(\boldsymbol{x}&#39;\)</span> in this finite set. This constraint enables the above equation to hold!</p>
<p>Note that <a href="#eq:approxstein">(3)</a> is not an exact analogue of <a href="#eq:stein">(1)</a> from before, but instead, <span class="math inline">\(O_P(\varepsilon_m)\)</span> means that it <em>decreases towards zero</em> as <span class="math inline">\(m\)</span> increases. I like to think of this as similar to sample size <span class="math inline">\(n\)</span> in most of statistics. Our accuracy increases as <span class="math inline">\(n\)</span> does, and in this case the same can be said of <span class="math inline">\(m\)</span>.</p>
<p>🚨🚨 <strong>Caution: Long Equation Ahead</strong> 🚨🚨</p>
<p>We can minimise in the same way as <a href="#eq:minsup">(2)</a>. Two theorems and a long analytic solution later we obtain our objective function,
<span class="math display">\[
\sum^d_{l=1} \mathbb{E}_{\boldsymbol{x} \sim q} \mathbb{E}_{\boldsymbol{y} \sim q} \left[ u_l(\boldsymbol{x}, \boldsymbol{y}) - \mathbf{v}_l(\boldsymbol{x})^\top(\mathbf{K}&#39;)^{-1}\mathbf{v}_l(\boldsymbol{y}) \right]
\]</span>
where
<span class="math display">\[\begin{align}
u_l(\boldsymbol{x}, \boldsymbol{y}) &amp;=\psi_{p, l}(\boldsymbol{x})\psi_{p, l}(\boldsymbol{y})k(\boldsymbol{x},\boldsymbol{y}) +\psi_{p, l}(\boldsymbol{x}) \partial_{y_l}k(\boldsymbol{x}, \boldsymbol{y}) \nonumber \\
&amp;\qquad \qquad+\psi_{p, l}(\boldsymbol{y}) \partial_{x_l}k(\boldsymbol{x}, \boldsymbol{y}) + \partial_{x_l}\partial_{y_l}k(\boldsymbol{x}, \boldsymbol{y}), \label{eq:ul}
\end{align}\]</span>
<span class="math inline">\(\mathbf{v}_l(\boldsymbol{z}) =\psi_{p, l}(\boldsymbol{z}) \boldsymbol{\varphi}_{\boldsymbol{z}, \mathbf{x}&#39;}^\top+ (\partial_{z_l}\boldsymbol{\varphi}_{\boldsymbol{z}, \mathbf{x}&#39;})^\top\)</span>, <span class="math inline">\(\boldsymbol{\varphi}_{\boldsymbol{z}, \mathbf{x}&#39;} = [ k(\boldsymbol{z}, \boldsymbol{x}_1&#39;), \dots, k(\boldsymbol{z}, \boldsymbol{x}_m&#39;) ]\)</span>, <span class="math inline">\(k\)</span> is the kernel function associated with the RKHS <span class="math inline">\(\mathcal{G}^d_{0, m}\)</span>, <span class="math inline">\(\boldsymbol{\phi}_{\mathbf{x}&#39;} = [k(\boldsymbol{x}_1&#39;, \cdot), \dots, k(\boldsymbol{x}_m&#39;, \cdot)]^\top\)</span> and <span class="math inline">\(\mathbf{K}&#39; = \boldsymbol{\phi}_{\mathbf{x}&#39;}\boldsymbol{\phi}_{\mathbf{x}&#39;}^\top\)</span>.</p>
<p><strong>Yes this is quite a lot. No it is not important to understand every detail.</strong> The key takeaway is that we have a loss function, consisting only of linear algebra operations, which we can minimise to obtain a truncated density estimate when the boundary is not known fully! 🎉🎉🎉</p>
<p><em>(There are also two assumptions for one final theorem which proves this is a consistent estimator. You think this sounds like a lot of theorems? This is only mild, as far as statistics papers go.)</em></p>
</div>
<div id="finally-something-interesting-results" class="section level1">
<h1>Finally something interesting, results!</h1>
<p>I know, I know, you must be thinking “Is the estimation error across a range of experiments comparable to previous implementations of truncated density estimators considering the use of an approximate set of boundary points instead of an exact functional form?”.</p>
<p>Or maybe you are just thinking “Is it better than the state-of-the-art?”. Same question, really. The answer is yes, it does pretty well.</p>
<div id="simulation-study" class="section level2">
<h2>Simulation Study</h2>
<figure class="image">
<center>
<img src="l2_d_approximate.png" alt="" />
<figcaption>
<strong>Figure 1</strong>: Simple simulation experiment with <span class="math inline">\(\ell_2\)</span> ball truncation.
</figcaption>
</center>
</figure>
<p>This plot shows mean estimation error over 64 trials in a simple task of estimating the mean of Gaussian distribution truncated within a <span class="math inline">\(\ell_2\)</span> ball, whilst varying the dimension <span class="math inline">\(d\)</span>. We compare TKSD to <em>TruncSM</em> under two scenarios, the exact scenario is where <em>TruncSM</em> has access to the explicit boundary formulation, and the approximate scenario is where it only has access to a finite number of samples on the boundary - the same samples we give to TKSD. Overall, TKSD trades blows with <em>TruncSM (exact)</em>, and does significantly better than <em>TruncSM (approximate)</em>, even though it is given the exact same information. <strong>So with less information, TKSD still matches the state-of-the-art method.</strong></p>
<figure class="image">
<center>
<img src="l1_d_approximate.png" alt="" />
<figcaption>
<strong>Figure 2</strong>: Simple simulation experiment with <span class="math inline">\(\ell_1\)</span> ball truncation.
</figcaption>
</center>
</figure>
<p>This second plot shows the same experiment setup but for truncation of the <span class="math inline">\(\ell_1\)</span> ball instead of the <span class="math inline">\(\ell_2\)</span> ball. We also plot runtime for all methods. Similar to the last experiment, TKSD and <em>TruncSM (exact)</em> have comparable errors across all dimensions. The main message in this example is how <em>long</em> it takes <em>TruncSM (exact)</em> to run, because analytically calculating the functional boundary for high dimension <span class="math inline">\(\ell_1\)</span> balls is costly, combinatorically costly with <span class="math inline">\(d\)</span>, in fact. <em>TruncSM (approximate)</em> is, like before, not very good, even though it is cheaper to run. Both instances of <em>TruncSM</em> have issues, whereas TKSD seems to be the superior option.</p>
<figure class="image">
<center>
<img src="mixture_ex.png" alt="" />
<figcaption>
<strong>Figure 3</strong>: More complicated simulation experiment with <span class="math inline">\(\ell_2\)</span> ball truncation on a mixed Gaussian distribution.
</figcaption>
</center>
</figure>
<figure class="image">
<center>
<img src="mixture.png" alt="" />
<figcaption>
<strong>Figure 4</strong>: Mixed Gaussian experiment results, varying across sample size <span class="math inline">\(n\)</span>, and number of mixture modes (amount of means estimated at once).
</figcaption>
</center>
</figure>
<p>The next set of experiments contains a more complex setup, which is estimating multiple modes of a mixed Gaussian distribution. This is a similar experiment setup to before, except we are estimating 2, 3 and 4 means of a Gaussian at the same time. Figure 3 shows the experiment visually; as we vary the number of mixture modes, the distribution becomes more complex and thus harder to estimate accurately.</p>
<p>Figure 4 shows the mean estimation error across 64 trials for TKSD and <em>TruncSM (exact)</em>. We vary the number of mixture modes (left) from 2-4, and measure how that changes the error across both methods. We also fix the number of mixture modes as 2, and vary sample size <span class="math inline">\(n\)</span> (right), and also compare the error. Across both experiments, TKSD is Ivan Drago, and <em>TruncSM</em> is Apollo Creed (sorry). <strong>TKSD has a significantly smaller error than <em>TruncSM</em>.</strong></p>
</div>
<div id="regression-example" class="section level2">
<h2>Regression Example</h2>
<figure class="image">
<center>
<img src="regression.png" alt="" />
<figcaption>
<strong>Figure 5</strong>: Example of using TKSD for regression on simulated data (left) and a real world example (right).
</figcaption>
</center>
</figure>
<p>Let’s look at one specific example before we go, a simple linear regression. Since TKSD is a density estimation method, we can use it to estimate parameters of the (conditional) mean of a Normal distribution, given some feature variables. Truncation happens in the <span class="math inline">\(y\)</span> domain, so that all of our data is truncated according to conditions on <span class="math inline">\(y\)</span>. In the first plot, we simulate a regression setting where we know the true parameters and can see the untruncated data. We pretend to only observe <span class="math inline">\(y_i \geq 5\)</span>, <span class="math inline">\(\forall i = 1,\dots, n\)</span>, and fit the model to the remaining data. When comparing the TKSD fit to a naive least squares implementation (MLE) which does not account for truncation, you can clearly see the difference that accounting for this simple truncation makes in our regression line.</p>
<p>The second plot is an experiment on a real-world dataset, given by UCLA: Statistical Consulting Group <a href="#data">[5]</a>. This dataset contains student test scores in a school for which the acceptance threshold is 40/100, and therefore the response variable (the
test scores) are truncated below by 40 and above by 100. Since no scores get close to 100, we only consider one-sided
truncation at <span class="math inline">\(y = 40\)</span>. The aim of the regression is to model the response variable, the test scores, based on a single covariate of each students’ corresponding score on a different test. We see very clearly in this example that accounting for this truncation seems to give a better fit than a regular least squares solution.</p>
</div>
</div>
<div id="conclusions" class="section level1">
<h1>Conclusions</h1>
<p>This work has taken up the majority of my PhD, around 2 years. It is more complicated than I have given it credit for in this post, and please do read the full paper if you want more detail. Even with all the detail, it is not a work that would normally take 2 years. It started as a way of extending the previous implementation we developed in <em>TruncSM</em>, to try and adaptively solve for what we were calling a ‘boundary function’. It became clear that score matching was holding us back, and then we kept having to add extra constraints and details to an implementation around Stein discrepancies. Amongst loads of different ideas, things also kept going wrong, so it is a great relief to see this research finished, working, and even performing extremely well, not to mention being accepted to ICML!</p>
<p>Anyway, why would you be interested in TKSD in general? If you care about truncated densities, and want something that is</p>
<ul>
<li>adaptive to the dataset at hand</li>
<li>requires no prior knowledge about the boundary, except being able to obtain samples from it</li>
<li>performs better in more complicated scenarios</li>
<li>has a nice theoretical and empirical results</li>
<li>is an acronym</li>
</ul>
<p>then look no further than TKSD!</p>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p><a href="https://www.jmlr.org/papers/volume23/21-0218/21-0218.pdf">[1]</a> <a id="truncsm"></a>Liu, S., Kanamori, T., and Williams, D. J. Estimating density models with truncation boundaries using score matching. Journal of Machine Learning Research, 23(186):1–38, 2022.</p>
<p><a href="https://www.jmlr.org/papers/volume6/hyvarinen05a/hyvarinen05a.pdf">[2]</a> <a id="scorematching1"></a>Hyvärinen, A. Estimation of non-normalized statistical models by score matching. Journal of Machine Learning Research, 6(24):695–709, 2005.</p>
<p><a href="https://proceedings.neurips.cc/paper_files/paper/2019/file/ba7609ee5789cc4dff171045a693a65f-Paper.pdf">[3]</a> <a id="barp2019"></a> Barp, A., Briol, F.-X., Duncan, A., Girolami, M., and Mackey, L. Minimum stein discrepancy estimators. In Advances in Neural Information Processing Systems, volume 32, 2019.</p>
<p><a href="http://proceedings.mlr.press/v48/chwialkowski16.pdf">[4]</a><a id="ksd"></a> Chwialkowski, K., Strathmann, H., and Gretton, A. A kernel test of goodness of fit. In Proceedings of The 33rd International Conference on Machine Learning, volume 48 of Proceedings of Machine Learning Research, pp. 2606–2615. PMLR, 2016</p>
<p><a href="https://stats.oarc.ucla.edu/stata/dae/truncated-regression/">[5]</a> <a id="data"></a> UCLA: Statistical Consulting Group. Truncated regression — stata data analysis examples. URL <a href="https://stats.oarc.ucla.edu/stata/dae/truncated-regression/" class="uri">https://stats.oarc.ucla.edu/stata/dae/truncated-regression/</a>. Accessed March 17, 2023.</p>
</div>

    </div>

    




<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/icml/">ICML</a>
  
  <a class="badge badge-light" href="/tag/phd-research/">PhD Research</a>
  
  <a class="badge badge-light" href="/tag/truncated-density-estimation/">Truncated Density Estimation</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://dannyjameswilliams.co.uk/post/tksd/&amp;text=2%20Years%20of%20PhD%20Research:%20Stein%20Discrepancies%20with%20a%20Twist" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://dannyjameswilliams.co.uk/post/tksd/&amp;t=2%20Years%20of%20PhD%20Research:%20Stein%20Discrepancies%20with%20a%20Twist" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=2%20Years%20of%20PhD%20Research:%20Stein%20Discrepancies%20with%20a%20Twist&amp;body=https://dannyjameswilliams.co.uk/post/tksd/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://dannyjameswilliams.co.uk/post/tksd/&amp;title=2%20Years%20of%20PhD%20Research:%20Stein%20Discrepancies%20with%20a%20Twist" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="whatsapp://send?text=2%20Years%20of%20PhD%20Research:%20Stein%20Discrepancies%20with%20a%20Twist%20https://dannyjameswilliams.co.uk/post/tksd/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://dannyjameswilliams.co.uk/post/tksd/&amp;title=2%20Years%20of%20PhD%20Research:%20Stein%20Discrepancies%20with%20a%20Twist" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  
  





  
    
    
    
      
    
    
    
    <div class="media author-card content-widget-hr">
      
        
        <img class="avatar mr-3 avatar-circle" src="/author/daniel-williams/avatar_hud775384d6e1de19a81664cb136eec910_257483_270x270_fill_q90_lanczos_center.jpg" alt="Daniel Williams">
      

      <div class="media-body">
        <h5 class="card-title"><a href="https://dannyjameswilliams.co.uk/">Daniel Williams</a></h5>
        <h6 class="card-subtitle">CDT Student</h6>
        <p class="card-text">I have a PhD in statistics/machine learning/data science/AI (whatever you would like to call it) from the University of Bristol, under the COMPASS CDT. I previously studied a masters in mathematics at the University of Exeter. My research was primarily on truncated density estimation and unnormalised models. But I am also interested in AI more generally, including all the learnings, Machine, Deep and Reinforcement (as well as some others!).</p>
        <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/DanielW966" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/dannyjameswilliams" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
</ul>

      </div>
    </div>
  







<section id="comments">
  
    <div id="commento"></div>

<script src="https://cdn.commento.io/js/commento.js" defer></script>

  
</section>








  
  





  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks",
        'slides' : "Slides"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.66c553246b0f279a03be6e5597f72b52.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    
  </p>

  
  






  <p class="powered-by">
    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
